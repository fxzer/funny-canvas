import{u as E}from"./useCanvas-b9fb9ced.js";import{d as q,r as s,o as z,a as k,c as w,k as u,t as S,j as A,s as I}from"./index-001d42e8.js";const N="/funny-canvas/assets/dream-613ba982.mp3",M={class:"h-full relative bg-white/10 backdrop-blur"},P={class:"w-80 left-0 right-0 mx-auto z-50 bg-white/50 backdrop-blur absolute bottom-36 rounded-full overflow-hidden flex-y-center"},U=u("label",{for:"upload",class:"font-mono text-purple-600 rounded-sm bg-purple-500/10 z-10 cursor-pointer px-2 py-1"},"选择文件",-1),V={class:"text-blue-600 bg-blue-600/10 px-2 py-1 truncate flex-1"},j={key:0,class:"loading text-3xl text-violet-600 bg-white/30 p-6 backdrop-blur absolute top-1/2 left-1/2 translate-1/2"},H=u("source",{src:N},null,-1),W=[H],K=q({__name:"index",setup($){const{canvasRef:F,context:i,width:v,height:h}=E(),e=s(),f=s(),d=s(null),n=s(null);let p=[];const b=s("Dream It Possible.mp3"),y=s(0),_=s(!1);function C(){var a,t;d.value=new AudioContext;const o=d.value.createMediaElementSource(e==null?void 0:e.value);e.value.volume=.2,n.value=d.value.createAnalyser(),o.connect(n.value),n.value.connect(d.value.destination),n.value.fftSize=256;const l=n.value.frequencyBinCount;p=new Uint8Array(l),document.addEventListener("click",()=>{var r,m,c;(r=e.value)!=null&&r.paused&&((m=d.value)==null||m.resume(),(c=e.value)==null||c.play())}),(a=e.value)==null||a.addEventListener("play",g),(t=e.value)==null||t.addEventListener("pause",()=>{cancelAnimationFrame(y.value)})}function R(o){var l;if(b.value=o.target.files[0].name||"Dream It Possible.mp3",(l=f.value)!=null&&l.files&&f.value.files[0]){_.value=!0;const a=new FileReader;a.onload=function(t){var r;e.value.src=(r=t.target)==null?void 0:r.result,e.value.load(),e.value.play()},a.readAsDataURL(f.value.files[0]),a.onloadend=()=>{_.value=!1}}}function g(){var o;if(i.value&&(i.value.clearRect(0,0,v.value,h.value),n.value)){n.value.getByteFrequencyData(p);const l=p.length/3,a=v.value/l/2;for(let t=0;t<l;t++){const m=p[t]/256,c=h.value*m,L=t*a+v.value/2,B=v.value/2-(t+1)*a,x=h.value-c,D=t/l*360;i.value.fillStyle=`hsl(${D}, 100%, 50%)`,i.value.fillRect(L,x,a-2,c),i.value.fillRect(B,x,a-2,c)}}(o=e.value)!=null&&o.paused||(y.value=requestAnimationFrame(g))}return z(()=>{C()}),(o,l)=>(k(),w("div",M,[u("canvas",{ref_key:"canvasRef",ref:F},null,512),u("input",{id:"upload",ref_key:"audioFile",ref:f,type:"file",class:"hidden",onChange:R},null,544),u("div",P,[U,u("span",V,S(A(b)),1)]),A(_)?(k(),w("div",j," 加载中... ")):I("",!0),u("audio",{ref_key:"audioA",ref:e,controls:"",class:"w-80 left-0 right-0 mx-auto z-50 absolute bottom-20"},W,512)]))}});export{K as default};

var be=Object.defineProperty;var we=(I,v,x)=>v in I?be(I,v,{enumerable:!0,configurable:!0,writable:!0,value:x}):I[v]=x;var u=(I,v,x)=>(we(I,typeof v!="symbol"?v+"":v,x),x);import{d as Ce,b as xe,o as ze,a as Ie,c as Se,k as H,j as Pe,F as Ee,E as Te}from"./index-001d42e8.js";import{u as Fe}from"./useCanvas-b9fb9ced.js";var U={};(function I(v,x,E,k){var B=!!(v.Worker&&v.Blob&&v.Promise&&v.OffscreenCanvas&&v.OffscreenCanvasRenderingContext2D&&v.HTMLCanvasElement&&v.HTMLCanvasElement.prototype.transferControlToOffscreen&&v.URL&&v.URL.createObjectURL),O=typeof Path2D=="function"&&typeof DOMMatrix=="function",_=function(){if(!v.OffscreenCanvas)return!1;var a=new OffscreenCanvas(1,1),e=a.getContext("2d");e.fillRect(0,0,1,1);var t=a.transferToImageBitmap();try{e.createPattern(t,"no-repeat")}catch{return!1}return!0}();function N(){}function A(a){var e=x.exports.Promise,t=e!==void 0?e:v.Promise;return typeof t=="function"?new t(a):(a(N,N),null)}var R=function(a,e){return{transform:function(t){if(a)return t;if(e.has(t))return e.get(t);var s=new OffscreenCanvas(t.width,t.height),o=s.getContext("2d");return o.drawImage(t,0,0),e.set(t,s),s},clear:function(){e.clear()}}}(_,new Map),y=function(){var a=Math.floor(16.666666666666668),e,t,s={},o=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(h){var l=Math.random();return s[l]=requestAnimationFrame(function n(c){o===c||o+a-1<c?(o=c,delete s[l],h()):s[l]=requestAnimationFrame(n)}),l},t=function(h){s[h]&&cancelAnimationFrame(s[h])}):(e=function(h){return setTimeout(h,a)},t=function(h){return clearTimeout(h)}),{frame:e,cancel:t}}(),r=function(){var a,e,t={};function s(o){function h(l,n){o.postMessage({options:l||{},callback:n})}o.init=function(n){var c=n.transferControlToOffscreen();o.postMessage({canvas:c},[c])},o.fire=function(n,c,g){if(e)return h(n,null),e;var M=Math.random().toString(36).slice(2);return e=A(function(p){function b(C){C.data.callback===M&&(delete t[M],o.removeEventListener("message",b),e=null,R.clear(),g(),p())}o.addEventListener("message",b),h(n,M),t[M]=b.bind(null,{data:{callback:M}})}),e},o.reset=function(){o.postMessage({reset:!0});for(var n in t)t[n](),delete t[n]}}return function(){if(a)return a;if(!E&&B){var o=["var CONFETTI, SIZE = {}, module = {};","("+I.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{a=new Worker(URL.createObjectURL(new Blob([o])))}catch(h){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("🎊 Could not load worker",h),null}s(a)}return a}}(),i={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function m(a,e){return e?e(a):a}function w(a){return a!=null}function f(a,e,t){return m(a&&w(a[e])?a[e]:i[e],t)}function Q(a){return a<0?0:Math.floor(a)}function X(a,e){return Math.floor(Math.random()*(e-a))+a}function D(a){return parseInt(a,16)}function Y(a){return a.map(ee)}function ee(a){var e=String(a).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:D(e.substring(0,2)),g:D(e.substring(2,4)),b:D(e.substring(4,6))}}function ae(a){var e=f(a,"origin",Object);return e.x=f(e,"x",Number),e.y=f(e,"y",Number),e}function te(a){a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight}function re(a){var e=a.getBoundingClientRect();a.width=e.width,a.height=e.height}function ne(a){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=a,e}function se(a,e,t,s,o,h,l,n,c){a.save(),a.translate(e,t),a.rotate(h),a.scale(s,o),a.arc(0,0,1,l,n,c),a.restore()}function ie(a){var e=a.angle*(Math.PI/180),t=a.spread*(Math.PI/180);return{x:a.x,y:a.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:a.startVelocity*.5+Math.random()*a.startVelocity,angle2D:-e+(.5*t-Math.random()*t),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:a.color,shape:a.shape,tick:0,totalTicks:a.ticks,decay:a.decay,drift:a.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:a.gravity*3,ovalScalar:.6,scalar:a.scalar,flat:a.flat}}function oe(a,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var t=e.tick++/e.totalTicks,s=e.x+e.random*e.tiltCos,o=e.y+e.random*e.tiltSin,h=e.wobbleX+e.random*e.tiltCos,l=e.wobbleY+e.random*e.tiltSin;if(a.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-t)+")",a.beginPath(),O&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))a.fill(le(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(h-s)*.1,Math.abs(l-o)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var n=Math.PI/10*e.wobble,c=Math.abs(h-s)*.1,g=Math.abs(l-o)*.1,M=e.shape.bitmap.width*e.scalar,p=e.shape.bitmap.height*e.scalar,b=new DOMMatrix([Math.cos(n)*c,Math.sin(n)*c,-Math.sin(n)*g,Math.cos(n)*g,e.x,e.y]);b.multiplySelf(new DOMMatrix(e.shape.matrix));var C=a.createPattern(R.transform(e.shape.bitmap),"no-repeat");C.setTransform(b),a.globalAlpha=1-t,a.fillStyle=C,a.fillRect(e.x-M/2,e.y-p/2,M,p),a.globalAlpha=1}else if(e.shape==="circle")a.ellipse?a.ellipse(e.x,e.y,Math.abs(h-s)*e.ovalScalar,Math.abs(l-o)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):se(a,e.x,e.y,Math.abs(h-s)*e.ovalScalar,Math.abs(l-o)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var d=Math.PI/2*3,z=4*e.scalar,S=8*e.scalar,P=e.x,F=e.y,L=5,T=Math.PI/L;L--;)P=e.x+Math.cos(d)*S,F=e.y+Math.sin(d)*S,a.lineTo(P,F),d+=T,P=e.x+Math.cos(d)*z,F=e.y+Math.sin(d)*z,a.lineTo(P,F),d+=T;else a.moveTo(Math.floor(e.x),Math.floor(e.y)),a.lineTo(Math.floor(e.wobbleX),Math.floor(o)),a.lineTo(Math.floor(h),Math.floor(l)),a.lineTo(Math.floor(s),Math.floor(e.wobbleY));return a.closePath(),a.fill(),e.tick<e.totalTicks}function he(a,e,t,s,o){var h=e.slice(),l=a.getContext("2d"),n,c,g=A(function(M){function p(){n=c=null,l.clearRect(0,0,s.width,s.height),R.clear(),o(),M()}function b(){E&&!(s.width===k.width&&s.height===k.height)&&(s.width=a.width=k.width,s.height=a.height=k.height),!s.width&&!s.height&&(t(a),s.width=a.width,s.height=a.height),l.clearRect(0,0,s.width,s.height),h=h.filter(function(C){return oe(l,C)}),h.length?n=y.frame(b):p()}n=y.frame(b),c=p});return{addFettis:function(M){return h=h.concat(M),g},canvas:a,promise:g,reset:function(){n&&y.cancel(n),c&&c()}}}function V(a,e){var t=!a,s=!!f(e||{},"resize"),o=!1,h=f(e,"disableForReducedMotion",Boolean),l=B&&!!f(e||{},"useWorker"),n=l?r():null,c=t?te:re,g=a&&n?!!a.__confetti_initialized:!1,M=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,p;function b(d,z,S){for(var P=f(d,"particleCount",Q),F=f(d,"angle",Number),L=f(d,"spread",Number),T=f(d,"startVelocity",Number),de=f(d,"decay",Number),fe=f(d,"gravity",Number),ve=f(d,"drift",Number),$=f(d,"colors",Y),ge=f(d,"ticks",Number),G=f(d,"shapes"),me=f(d,"scalar"),pe=!!f(d,"flat"),J=ae(d),K=P,j=[],ye=a.width*J.x,Me=a.height*J.y;K--;)j.push(ie({x:ye,y:Me,angle:F,spread:L,startVelocity:T,color:$[K%$.length],shape:G[X(0,G.length)],ticks:ge,decay:de,gravity:fe,drift:ve,scalar:me,flat:pe}));return p?p.addFettis(j):(p=he(a,j,c,z,S),p.promise)}function C(d){var z=h||f(d,"disableForReducedMotion",Boolean),S=f(d,"zIndex",Number);if(z&&M)return A(function(T){T()});t&&p?a=p.canvas:t&&!a&&(a=ne(S),document.body.appendChild(a)),s&&!g&&c(a);var P={width:a.width,height:a.height};n&&!g&&n.init(a),g=!0,n&&(a.__confetti_initialized=!0);function F(){if(n){var T={getBoundingClientRect:function(){if(!t)return a.getBoundingClientRect()}};c(T),n.postMessage({resize:{width:T.width,height:T.height}});return}P.width=P.height=null}function L(){p=null,s&&(o=!1,v.removeEventListener("resize",F)),t&&a&&(document.body.removeChild(a),a=null,g=!1)}return s&&!o&&(o=!0,v.addEventListener("resize",F,!1)),n?n.fire(d,P,L):b(d,P,L)}return C.reset=function(){n&&n.reset(),p&&p.reset()},C}var q;function Z(){return q||(q=V(null,{useWorker:!0,resize:!0})),q}function le(a,e,t,s,o,h,l){var n=new Path2D(a),c=new Path2D;c.addPath(n,new DOMMatrix(e));var g=new Path2D;return g.addPath(c,new DOMMatrix([Math.cos(l)*o,Math.sin(l)*o,-Math.sin(l)*h,Math.cos(l)*h,t,s])),g}function ce(a){if(!O)throw new Error("path confetti are not supported in this browser");var e,t;typeof a=="string"?e=a:(e=a.path,t=a.matrix);var s=new Path2D(e),o=document.createElement("canvas"),h=o.getContext("2d");if(!t){for(var l=1e3,n=l,c=l,g=0,M=0,p,b,C=0;C<l;C+=2)for(var d=0;d<l;d+=2)h.isPointInPath(s,C,d,"nonzero")&&(n=Math.min(n,C),c=Math.min(c,d),g=Math.max(g,C),M=Math.max(M,d));p=g-n,b=M-c;var z=10,S=Math.min(z/p,z/b);t=[S,0,0,S,-Math.round(p/2+n)*S,-Math.round(b/2+c)*S]}return{type:"path",path:e,matrix:t}}function ue(a){var e,t=1,s="#000000",o='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof a=="string"?e=a:(e=a.text,t="scalar"in a?a.scalar:t,o="fontFamily"in a?a.fontFamily:o,s="color"in a?a.color:s);var h=10*t,l=""+h+"px "+o,n=new OffscreenCanvas(h,h),c=n.getContext("2d");c.font=l;var g=c.measureText(e),M=Math.ceil(g.actualBoundingBoxRight+g.actualBoundingBoxLeft),p=Math.ceil(g.actualBoundingBoxAscent+g.actualBoundingBoxDescent),b=2,C=g.actualBoundingBoxLeft+b,d=g.actualBoundingBoxAscent+b;M+=b+b,p+=b+b,n=new OffscreenCanvas(M,p),c=n.getContext("2d"),c.font=l,c.fillStyle=s,c.fillText(e,C,d);var z=1/t;return{type:"bitmap",bitmap:n.transferToImageBitmap(),matrix:[z,0,0,z,-M*z/2,-p*z/2]}}x.exports=function(){return Z().apply(this,arguments)},x.exports.reset=function(){Z().reset()},x.exports.create=V,x.exports.shapeFromPath=ce,x.exports.shapeFromText=ue})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),U,!1);const W=U.exports;U.exports.create;function Le(I=80){const v={colors:["#5D8C7B","#F2D091","#F2A679","#D9695F","#8C4646"],shapes:["square"],ticks:500};W({...v,particleCount:I,spread:100,origin:{y:0}}),setTimeout(()=>{W({...v,particleCount:50+(I-80),angle:60,spread:50,origin:{x:0}})},250),setTimeout(()=>{W({...v,particleCount:50+(I-80),angle:120,spread:50,origin:{x:1}})},400)}const ke=Te('<svg class="heart hidden cursor-crosshair" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 133.8 133.8"><g id="inner"><path class="st0" d="M41.9 100.7L11.8 70.6C-2 56.8-2 34.3 11.8 20.5c13.8-13.8 36.3-13.8 50.1 0L92 50.6c13.8 13.8 13.8 36.3 0 50.1-13.8 13.8-36.4 13.8-50.1 0z"></path><path class="st0" d="M41.9 50.6L72 20.5c13.8-13.8 36.3-13.8 50.1 0 13.8 13.8 13.8 36.3 0 50.1L92 100.7c-13.8 13.8-36.3 13.8-50.1 0-13.8-13.8-13.8-36.3 0-50.1z"></path><path class="st0" d="M63.4 122.2L36.6 95.4c-1.9-1.9-1.9-5.1 0-7.1l26.8-26.8c1.9-1.9 5.1-1.9 7.1 0l26.8 26.8c1.9 1.9 1.9 5.1 0 7.1l-26.8 26.8c-2 1.9-5.2 1.9-7.1 0z"></path></g></svg>',1),Ae=H("div",{fixed:"",class:"tip cursor-pointer top-1/2 left-1/2 text-gray z-10"}," 请点击屏幕 ",-1),Ne=Ce({__name:"index",setup(I){const v=xe(),{canvasRef:x}=Fe();function E(y,r){return Math.floor(Math.random()*(r-y+1))+y}function k(y,r){return Number((Math.random()*(r-y)+y).toFixed(4))}function B(){return[-1,1][E(0,1)]}function O(y){return y.substring(4,y.length-1).replace(/ /g,"").split(",").map(r=>Number(r))}function _(y){const r=[];for(const i of y){const m=255-i,w=255-Math.floor(Math.random()*(m*2));r.push(w)}return`rgb(${r[0]},${r[1]},${r[2]})`}class N{constructor(r,i,m,w){u(this,"speed");u(this,"radius");u(this,"direction");u(this,"dead");u(this,"angle");u(this,"birthday");u(this,"x");u(this,"y");u(this,"alpha");u(this,"size");u(this,"startSize");u(this,"baby");u(this,"img");u(this,"cx");u(this,"cy");const f=r*k(.2,1.2);this.alpha=0,this.startSize=r,this.size=r/3,this.baby=!0,this.img=i,this.cx=E(m-f,m+f),this.cy=E(w-f,w+f),this.speed=E(500,1500),this.radius=E(5,30),this.direction=B(),this.dead=!1,this.angle=0,this.birthday=performance.now()}animate(r){const i=r-this.birthday,m=this.startSize/500;this.angle=Math.PI*(r/this.speed),this.direction===1?(this.x=this.cx+Math.cos(this.angle)*this.radius,this.y=this.cy+Math.sin(this.angle)*this.radius):(this.x=this.cx-Math.sin(this.angle)*this.radius,this.y=this.cy-Math.cos(this.angle)*this.radius),this.alpha=this.size/this.startSize,this.baby?this.size=this.size+i*m:this.size=this.startSize-i/2.2*m,this.size>=this.startSize&&(this.baby=!1,this.birthday=r,this.startSize=this.size),this.size<0&&(this.dead=!0)}}class A{constructor(r,i,m,w){u(this,"size");u(this,"x");u(this,"y");u(this,"img");u(this,"dead");u(this,"fadeout");u(this,"birthday");u(this,"w");u(this,"alpha");this.size=0,this.x=i,this.y=m,this.img=r,this.dead=!1,this.fadeout=!1,this.birthday=performance.now(),this.w=w.width,this.alpha=.6}fade(){this.fadeout=!0}animate(r){const i=r-this.birthday;this.size+=i/10,this.alpha-=i/5e4,this.alpha<0&&(this.dead=!0)}}class R{constructor(r,i){u(this,"size");u(this,"paint");u(this,"clicking");u(this,"heartArray");u(this,"color");u(this,"svg");u(this,"canvas");u(this,"ctx");u(this,"cycle");u(this,"rqfid");this.size=20,this.paint=!1,this.clicking=!1,this.heartArray=[],this.color="rgb(255,83,93)",this.rqfid=0,this.svg=i,this.canvas=r,this.ctx=this.canvas.getContext("2d"),this.canvasSize=this.canvasSize.bind(this),this.pushLogo=this.pushLogo.bind(this),this.bindEvents(),this.canvasSize(),this.animateCanvas(10)}canvasSize(){const r=window.getComputedStyle(this.canvas,null),i=Number(r.getPropertyValue("width").slice(0,-2)),m=Number(r.getPropertyValue("height").slice(0,-2));this.canvas.width=i,this.canvas.height=m}bindEvents(){this.canvas.addEventListener("mousedown",()=>{this.clicking=!0}),this.canvas.addEventListener("mouseup",()=>{this.clicking=!1,this.killGrowHearts()}),["mouseenter","touchstart"].forEach(w=>{this.canvas.addEventListener(w,()=>{this.paint=!0,this.pushLogo(),this.cycle=setInterval(()=>this.pushLogo(),100)},!1)}),["mouseleave","touchend"].forEach(w=>{this.canvas.addEventListener(w,()=>{this.clearCycle(),this.paint=!1},!1)}),["mousemove","touchdrag"].forEach(w=>{this.canvas.addEventListener(w,()=>{this.clearCycle(),this.paint&&(this.pushLogo(),this.cycle=setInterval(()=>this.pushLogo(),100))},!1)})}killGrowHearts(){for(const r of this.heartArray)r.fade&&r.fade()}clearCycle(){clearInterval(this.cycle),this.cycle=null}pushLogo(){const r=Math.floor(E(20,100)/this.size);for(let i=0;i<r;i++){const m=O(this.color),w=_(m);if(this.clicking){const f=new A(this.createImg(w),this.getMousePos().x,this.getMousePos().y,this.canvas);this.heartArray.push(f)}else{const f=new N(E(this.size-20,this.size+20),this.createImg(w),this.getMousePos().x,this.getMousePos().y);this.heartArray.push(f)}}}createImg(r){this.svg.querySelector("#inner").style.fill=r;const i=new XMLSerializer().serializeToString(this.svg),m=new Image;return m.src=`data:image/svg+xml;charset=utf-8,${i}`,m}getMousePos(){const r=this.canvas.getBoundingClientRect(),i=v.x.value,m=v.y.value;return{x:i-r.left,y:m-r.top}}animateCanvas(r){if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.heartArray.length>0)for(const i of this.heartArray)if(i.dead){const m=this.heartArray.indexOf(i);this.heartArray.splice(m,1)}else{const m=i.x-i.size/2,w=i.y-i.size/2;this.ctx.globalAlpha=i.alpha,this.ctx.drawImage(i.img,m,w,i.size,i.size),i.animate(r)}cancelAnimationFrame(this.rqfid),this.rqfid=requestAnimationFrame(i=>this.animateCanvas(i))}}return ze(()=>{const y=document.querySelector(".heart"),r=document.querySelector("canvas");r&&y&&new R(r,y),window.addEventListener("click",()=>{var i;(i=document.querySelector(".tip"))==null||i.classList.add("!hidden")})}),(y,r)=>(Ie(),Se(Ee,null,[H("canvas",{ref_key:"canvasRef",ref:x},null,512),ke,Ae,H("div",{fixed:"",class:"tip cursor-pointer bottom-3 right-3 text-gray select-none z-10 hover:bg-gray-400/20 hover:text-amber p-2 rounded",onClick:r[0]||(r[0]=i=>Pe(Le)(200))}," 完结撒花 ")],64))}});export{Ne as default};
